% Customizing the table of contents entries
\titlecontents{chapter}[0pc]
{\addvspace{30pt}}%
{\begin{tikzpicture}[remember picture, overlay]%
    \draw[fill=MainColor!80, draw=MainColor!80] (-4,-.2) rectangle (-0.2,.5);%
    \pgftext[left,x=-3.1cm,y=0.2cm]{\color{white}\Large\sc\bfseries Capitolo \thecontentslabel};%
\end{tikzpicture}\color{MainColor!90}\large\sc\bfseries}
{\color{MainColor!90}\large\sc\bfseries}
{\color{MainColor!90}\;\titlerule\;\large\sc\bfseries Pagina \thecontentspage
    \begin{tikzpicture}[remember picture, overlay]
        \draw[fill=MainColor!70, draw=MainColor!70] (2pt,0) rectangle (6,0.1pt);
    \end{tikzpicture}}%

% Section formatting
\titlecontents{section}[2.4pc]
{\addvspace{1pt}}
{\contentslabel[\thecontentslabel]{2.4pc}}
{}
{\dotfill\small \thecontentspage}
[]

% Subsection formatting
\titlecontents{subsection}[5pc]
{\addvspace{1pt}}
{\contentslabel[\thecontentslabel]{2.4pc}}
{}
{\dotfill\small \thecontentspage}
[]

% Customizing the table of contents title
\makeatletter
\renewcommand{\tableofcontents}{%
    \chapter*{%
        \vspace*{-20pt}%
        \begin{tikzpicture}[remember picture, overlay]%
            \pgftext[right,x=14.84cm,y=0.2cm]{\color{MainColor!80}\Huge\sc\bfseries    
            \contentsname};%
            \draw[fill=MainColor!80, draw=MainColor!80] (13,-.75) rectangle (20,1);%
            \clip (13,-.75) rectangle (20,1);
            \pgftext[right,x=14.84cm,y=0.2cm]{\color{white}\Huge\sc\bfseries 
            \contentsname};%
        \end{tikzpicture}}%
    \@starttoc{toc}}
\makeatother
